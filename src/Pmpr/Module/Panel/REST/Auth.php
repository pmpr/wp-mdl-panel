<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             681751ecf2ea8             |
    |_______________________________________|
*/
 namespace Pmpr\Module\Panel\REST; use Exception; use Firebase\JWT\JWT; use Pmpr\Common\Foundation\FormGenerator\Field; use Pmpr\Common\Foundation\Interfaces\Constants; use WP_Error; use WP_HTTP_Response; use WP_REST_Request; use WP_REST_Response; class Auth extends Common { const gagkiiqqiysqqgmc = 'register'; const isawmsicsoammssc = 'email_otp'; const mmoiwccmooyskayc = 'mobile_otp'; const soawgaqmsgmysyma = 'reset_password'; const igswqqsosoeiociu = 'forgot_password'; const ykykecaaygoeyuuq = 'traditional_login'; const scagkwwiiquocimc = 'last_name'; const kagqiwogmiguosiw = 'first_name'; const oysqakmiwsaqskce = 'repeat_password'; protected ?WP_Error $error = null; public function __construct() { $this->rest_base = 'auth'; parent::__construct(); } public function wigskegsqequoeks() { $this->qcsmikeggeemccuu('wp_logout', [$this, 'oywwmwwwqeuiomka'], 999); } public function kgquecmsgcouyaya() { $this->cecaguuoecmccuse('reset_pre_dispatch', [$this, 'ywsiiikuswoyowaw'])->cecaguuoecmccuse('determine_current_user', [$this, 'aeicekasgokuuoqm']); $this->aqaqisyssqeomwom('get_jwt_auth_user', [$this, 'issssuygyewuaswa'])->aqaqisyssqeomwom('get_jwt_auth_token', [$this, 'sygeeqgwywmygsyu']); parent::kgquecmsgcouyaya(); } public function euekiyuksecoccus() : ?WP_Error { return $this->error; } public function yauwooaeicgosquo(?WP_Error $iswcokucwmiosiaq) : void { $this->error = $iswcokucwmiosiaq; } public function register_routes() { $this->register('/get-login-providers', [Constants::wwgusigoaksqmwsm => [$this, 'vomyocgeymkomqqm']]); $this->register('/get-fields', [Constants::wwgusigoaksqmwsm => [$this, 'ugmceccgwaaaigiy']]); $this->register('/send-code', [Constants::oaggieeykyaoiiyw => self::qucyckeykeuuaquw, Constants::wwgusigoaksqmwsm => [$this, 'iyogyoekowaukeyo']]); $this->register('/login', [Constants::oaggieeykyaoiiyw => self::qucyckeykeuuaquw, Constants::wwgusigoaksqmwsm => [$this, 'kkmkcysyceyiwskq']]); $this->register('/logout', [Constants::oaggieeykyaoiiyw => self::qucyckeykeuuaquw, Constants::wwgusigoaksqmwsm => [$this, 'aiamgkiewwakoegy']]); $this->register('/verify', [Constants::wwgusigoaksqmwsm => [$this, 'ussowkigumoaoowo']]); $this->register('/change-password', [Constants::oaggieeykyaoiiyw => self::ouuaeeeqeqkagcgi, Constants::wwgusigoaksqmwsm => [$this, 'agcywkwaoqkkccgk']]); $this->register('/me', [Constants::wwgusigoaksqmwsm => [$this, 'auosyisuakguyimw']]); $this->woekqgykywwycyci(); } public function aeicekasgokuuoqm($mkucggyaiaukqoce) { $qoockacwwamsuscm = $this->uwkmaywceaaaigwo()->giiecckwoyiawoyy()->ymsasggoakmgguqk(); $wigqmiauciuswcom = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->ekcymmyqoceukosc(); if (strpos($wigqmiauciuswcom, $qoockacwwamsuscm) && strpos($wigqmiauciuswcom, '/panel/auth/verify')) { $keccaugmemegoimu = $this->sygeeqgwywmygsyu(false); if (is_wp_error($keccaugmemegoimu) && $keccaugmemegoimu->get_error_code() !== 'no_auth_header') { $this->yauwooaeicgosquo($keccaugmemegoimu); } else { [$mgegoogckgsumooq, $smecmmgoykqcaieu] = $keccaugmemegoimu; $mkucggyaiaukqoce = $smecmmgoykqcaieu->data->user->id; } } return $mkucggyaiaukqoce; } public function oywwmwwwqeuiomka($mkucggyaiaukqoce) { } public function vomyocgeymkomqqm(WP_REST_Request $aqmwamyiwgeeymqa) { $ukiskwsmqscwauuu = $this->ocksiywmkyaqseou('third_party_auth_login_providers', []); if ($ukiskwsmqscwauuu) { foreach ($ukiskwsmqscwauuu as $momcykaoccoymeig => $iwigiqwyskocowwo) { $wkaqekwwgqsqwcoi = $iwigiqwyskocowwo[Constants::qgqyauaqwqmqseim] ?? null; if (is_numeric($wkaqekwwgqsqwcoi)) { $ukiskwsmqscwauuu[$momcykaoccoymeig][Constants::qgqyauaqwqmqseim] = $this->caokeucsksukesyo()->iqsmaqoiukeasukw()->mgaeeqsgeoukeokc($wkaqekwwgqsqwcoi); } } $keccaugmemegoimu = $ukiskwsmqscwauuu; } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('there is no login provider.', PR__MDL__PANEL), 404); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function ugmceccgwaaaigiy(WP_REST_Request $aqmwamyiwgeeymqa) { $ikgwqyuyckaewsow = $this->cqsmgqiwwuasmkiq(); if ($ikgwqyuyckaewsow) { foreach ($ikgwqyuyckaewsow as $ymqmyyeuycgmigyo => $ccamueccusigaaio) { foreach ($ccamueccusigaaio as $momcykaoccoymeig => $aiowsaccomcoikus) { if ($aiowsaccomcoikus instanceof Field) { $aiowsaccomcoikus->uuagoowwgcuosuuu()->eumecwmqmukqgyea()->qigsyyqgewgskemg('form-control-solid')->gkkgsyeumismsyse('font-size-h6 text-dark'); $ikgwqyuyckaewsow[$ymqmyyeuycgmigyo][$momcykaoccoymeig] = $aiowsaccomcoikus; if ($ccamueccusigaaio === self::gagkiiqqiysqqgmc) { $aiowsaccomcoikus->smcqugueqiumkygs(); } } } $this->ocksiywmkyaqseou("panel_auth_{$ymqmyyeuycgmigyo}_fields", $ccamueccusigaaio); $ikgwqyuyckaewsow[$ymqmyyeuycgmigyo] = $this->ayssaocauwgssywa($ccamueccusigaaio); } $keccaugmemegoimu = $ikgwqyuyckaewsow; } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('can not found requested fields.', PR__MDL__PANEL), 404); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function mmusmqyoussiyygq(WP_REST_Request $aqmwamyiwgeeymqa, string $ccamueccusigaaio) : array { $icwicymcioeyeyek = []; $ikgwqyuyckaewsow = $this->cqsmgqiwwuasmkiq($ccamueccusigaaio); if ($ikgwqyuyckaewsow) { foreach ($ikgwqyuyckaewsow as $aiowsaccomcoikus) { if ($aiowsaccomcoikus instanceof Field) { $eqgoocgaqwqcimie = $this->swmwoeaaeqiouswg($aqmwamyiwgeeymqa, $aiowsaccomcoikus->mwikyscisascoeea(), $aiowsaccomcoikus->oiswysuiioecsaae()); if (!$eqgoocgaqwqcimie && $aiowsaccomcoikus->msmiagueogcsucgc()) { $icwicymcioeyeyek = false; break; } $icwicymcioeyeyek[$aiowsaccomcoikus->mwikyscisascoeea()] = $eqgoocgaqwqcimie; } } } return $icwicymcioeyeyek; } private function cqsmgqiwwuasmkiq(string $ccamueccusigaaio = Constants::ALL) : array { $gusoaiguqeaommcc = $this->caokeucsksukesyo()->kugiyqykwaskawsc(); $ymwmimkuaqwgkgqc = __('Email', PR__MDL__PANEL); $ikgwqyuyckaewsow = [Constants::yuguikokwoymmqem => [$gusoaiguqeaommcc->ymuegqgyuagyucws(Constants::miqkwqsewyogmsak)->qigsyyqgewgskemg('text-center')->gswweykyogmsyawy($ymwmimkuaqwgkgqc)->kqqqugemmqagucuq()], self::isawmsicsoammssc => [$gusoaiguqeaommcc->ymuegqgyuagyucws(Constants::gseiuyggikuamsak)->ougkuowgkuqmwkka(5)], self::mmoiwccmooyskayc => [$gusoaiguqeaommcc->ymuegqgyuagyucws(Constants::gseiuyggikuamsak)->ougkuowgkuqmwkka(5)], Constants::akywgoyaseymiyka => [$gusoaiguqeaommcc->ymuegqgyuagyucws(Constants::iqgqyoowkoeugsck)->gswweykyogmsyawy(__('Enter Your Password', PR__MDL__PANEL))->sqsumkuougquscyg()]]; $ikgwqyuyckaewsow = (array) $this->ocksiywmkyaqseou('panel_auth_fields', $ikgwqyuyckaewsow); return $this->caokeucsksukesyo()->ywqgcuymeiswqyqc()->get($ikgwqyuyckaewsow, $ccamueccusigaaio, $ikgwqyuyckaewsow); } public function agcywkwaoqkkccgk(WP_REST_Request $aqmwamyiwgeeymqa) { $mkucggyaiaukqoce = $this->issssuygyewuaswa($aqmwamyiwgeeymqa); if (!is_wp_error($mkucggyaiaukqoce)) { $yeacayasgueouoqc = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::asmooogmgyecqqka); $qqwegysogaocgeww = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::akywgoyaseymiyka); if ($qqwegysogaocgeww && $yeacayasgueouoqc) { if ($yeacayasgueouoqc === $qqwegysogaocgeww) { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Entered current password and new password is same.', PR__MDL__PANEL), 400); } else { if ($this->uwkmaywceaaaigwo()->gyecsegqciqykomu()->eoiyuwsiwqyqiyom($yeacayasgueouoqc, $mkucggyaiaukqoce->user_pass, $mkucggyaiaukqoce->ID)) { $keccaugmemegoimu = new WP_Error(); $this->cqscqicucmeamkyq('validate_password_reset', $keccaugmemegoimu, $mkucggyaiaukqoce); if (!$keccaugmemegoimu->has_errors()) { $this->uwkmaywceaaaigwo()->issssuygyewuaswa()->sqaoqqooqowugmcw($mkucggyaiaukqoce, $qqwegysogaocgeww); $keccaugmemegoimu = $this->qasywwyamoesisyi(__('Password changed successfully', PR__MDL__PANEL)); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Entered current password is not correct.', PR__MDL__PANEL), 400); } } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Missing parameter.', PR__MDL__PANEL), 400); } } else { $keccaugmemegoimu = $mkucggyaiaukqoce; } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function woekqgykywwycyci() { $uykgysuswksgmwqy = 'Access-Control-Allow-Headers, Content-Type, Authorization'; header(sprintf('Access-Control-Allow-Headers: %s', $uykgysuswksgmwqy)); } public function ywsiiikuswoyowaw(WP_REST_Request $aqmwamyiwgeeymqa) { $iswcokucwmiosiaq = $this->euekiyuksecoccus(); if (is_wp_error($iswcokucwmiosiaq)) { $aqmwamyiwgeeymqa = $iswcokucwmiosiaq; } return $aqmwamyiwgeeymqa; } public function aiamgkiewwakoegy(WP_REST_Request $aqmwamyiwgeeymqa) { return $this->ewmkmmsuiuwmmwoy($this->qasywwyamoesisyi(__('Logged out', PR__MDL__PANEL))); } public function iyogyoekowaukeyo(WP_REST_Request $aqmwamyiwgeeymqa) { $moeywsaososecuqg = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::miqkwqsewyogmsak); if ($moeywsaososecuqg) { if ($this->caokeucsksukesyo()->cqusmgskowmesgcg()->iqqgmieeqemiowuk('otp', Constants::ycaueuokiswkqaoc)) { $ckggaguoewuaukyu = pr_utility_otp_get_request(); $sogksuscggsicmac = $ckggaguoewuaukyu->ioimaaeesiaysecu($moeywsaososecuqg, $this->caokeucsksukesyo()->issssuygyewuaswa()->mmscegoieayuaguo()); if ($sogksuscggsicmac && !is_wp_error($sogksuscggsicmac)) { $uuyoeicyoayimaoa = $ckggaguoewuaukyu->cwowqcisacowuqec(); $keccaugmemegoimu = ['expire_text' => sprintf(__('The submission code will be sent after %s.', PR__MDL__PANEL), $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->ciuuiyckmsygceis('%s')), Constants::cgiswgcumueqgcmw => $uuyoeicyoayimaoa * MINUTE_IN_SECONDS, Constants::mgowaqweusymwoqu => sprintf(__('A temporary login code has been sent to the %s below:', PR__MDL__PANEL), $ckggaguoewuaukyu->yomgsemomcmgekyi(Constants::squoamkioomemiyi, $sogksuscggsicmac[Constants::iikosyqiawkweouo]))]; } else { if (!is_wp_error($sogksuscggsicmac)) { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Can not send code right now, please try later.', PR__MDL__PANEL), 503); } else { $keccaugmemegoimu = $sogksuscggsicmac; } } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Something wrong, can not send code right now, please contact us.', PR__MDL__PANEL), 503); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Entered values is not valid.', PR__MDL__PANEL), 400); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function kkmkcysyceyiwskq(WP_REST_Request $aqmwamyiwgeeymqa) { $moeywsaososecuqg = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::miqkwqsewyogmsak); if ($moeywsaososecuqg) { $yoiguusocukqeayg = $this->caokeucsksukesyo()->issssuygyewuaswa(); $ewgmommeawggyaek = $this->uwkmaywceaaaigwo()->issssuygyewuaswa(); $ewgmommeawggyaek->aiamgkiewwakoegy(); $ycoeoaakqyskgykq = $keccaugmemegoimu = null; try { if ($qqwegysogaocgeww = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::iqgqyoowkoeugsck)) { $mkucggyaiaukqoce = $ewgmommeawggyaek->hmisgsqkawsgmqou([Constants::miqkwqsewyogmsak => $moeywsaososecuqg, Constants::iqgqyoowkoeugsck => $qqwegysogaocgeww]); if (is_wp_error($mkucggyaiaukqoce)) { $keccaugmemegoimu = $mkucggyaiaukqoce; } else { $ycoeoaakqyskgykq = $yoiguusocukqeayg->iooowgsqoyqseyuu($mkucggyaiaukqoce); } } else { if ($eqiqeycqwqiygcmg = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::gseiuyggikuamsak)) { if ($this->caokeucsksukesyo()->cqusmgskowmesgcg()->iqqgmieeqemiowuk('otp', Constants::ycaueuokiswkqaoc)) { $ckggaguoewuaukyu = pr_utility_otp_get_request(); $weeieoygyecwmikq = $ckggaguoewuaukyu->seeeuukuamcwiymk($moeywsaososecuqg, $eqiqeycqwqiygcmg); if (!is_wp_error($weeieoygyecwmikq)) { $ycoeoaakqyskgykq = $ckggaguoewuaukyu->waecsyqmwascmqoa($weeieoygyecwmikq, Constants::yauicucwkgqyygas); if (!$ycoeoaakqyskgykq) { $yewiaiaauukwsgku = $yoiguusocukqeayg->yqacukkgousiuaqq(current(explode('@', $moeywsaososecuqg))); $qqwegysogaocgeww = $ewgmommeawggyaek->myuiaumaacseywog(); $owaiikyuwwwmswgc = null; $gsikmsakcyiwacac = $ckggaguoewuaukyu->ogegcqqcukiaqscy(Constants::squoamkioomemiyi, $weeieoygyecwmikq); switch ($gsikmsakcyiwacac) { case Constants::muqaqimusmckkieq: $owaiikyuwwwmswgc = $moeywsaososecuqg; break; case Constants::skogicecygyyskkq: $owaiikyuwwwmswgc = $moeywsaososecuqg . '@example.local'; break; } $ycoeoaakqyskgykq = $ewgmommeawggyaek->gesyeyeaqmiskuoo($yewiaiaauukwsgku, $qqwegysogaocgeww, $owaiikyuwwwmswgc); if (is_wp_error($ycoeoaakqyskgykq)) { if ($gsikmsakcyiwacac === Constants::skogicecygyyskkq) { $yoiguusocukqeayg->ksmqawcowkmegigw(Constants::uymswsomcyoqsegc, $moeywsaososecuqg, $ycoeoaakqyskgykq); } $keccaugmemegoimu = $ycoeoaakqyskgykq; $ycoeoaakqyskgykq = 0; } } } else { $keccaugmemegoimu = $weeieoygyecwmikq; } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Something wrong, can not send code right now, please contact us.', PR__MDL__PANEL), 503); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->cackyykusuowuiwg(); } } if ($ycoeoaakqyskgykq && !is_wp_error($keccaugmemegoimu)) { $mkucggyaiaukqoce = $yoiguusocukqeayg->get($ycoeoaakqyskgykq, true); if ($mkucggyaiaukqoce) { $ewgmommeawggyaek->kkkuqwaqakeaykmo($ycoeoaakqyskgykq, $mkucggyaiaukqoce->user_login); $ewgmommeawggyaek->qsgmugaqymqgqayy($ycoeoaakqyskgykq); $this->cqscqicucmeamkyq('wp_login', $mkucggyaiaukqoce->user_login, $mkucggyaiaukqoce); $keccaugmemegoimu = $this->ysyiouymigoigsma($ycoeoaakqyskgykq); } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Can not login now, please try later.', PR__MDL__PANEL)); } } } catch (Exception $wgaoewqkwgomoaai) { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis($wgaoewqkwgomoaai, 500); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->cackyykusuowuiwg(); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function ussowkigumoaoowo($aqmwamyiwgeeymqa) { $keccaugmemegoimu = $this->sygeeqgwywmygsyu($aqmwamyiwgeeymqa); if (!is_wp_error($keccaugmemegoimu)) { [$mgegoogckgsumooq, $smecmmgoykqcaieu] = $keccaugmemegoimu; $keccaugmemegoimu = [Constants::meksegaoamowuwoq => $this->ksoemussqmaacucm($smecmmgoykqcaieu->data->user->id), Constants::sygmkaeayiiouiwm => $mgegoogckgsumooq]; } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function auosyisuakguyimw(WP_REST_Request $aqmwamyiwgeeymqa) { $keccaugmemegoimu = $this->sygeeqgwywmygsyu($aqmwamyiwgeeymqa); if (!is_wp_error($keccaugmemegoimu)) { [$mgegoogckgsumooq, $smecmmgoykqcaieu] = $keccaugmemegoimu; $keccaugmemegoimu = [Constants::meksegaoamowuwoq => $this->ksoemussqmaacucm($smecmmgoykqcaieu->data->user->id), Constants::uiwqcumqkgikqyue => [Constants::ciywsqoeiymemsys => 200], Constants::vswoiouoaykswgym => 'auth_get_me', 'account' => []]; } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } }
